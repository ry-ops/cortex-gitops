# Cortex Daily Brief - "What I Learned Today" Feature Restoration

**Date**: January 15, 2026
**Status**: ‚ö†Ô∏è Partially Complete - Needs YouTube API endpoint

---

## What Was Requested

Restore the "What has chat learned today" function that used to query YouTube video summaries from the IBM Technology channel.

---

## What Was Found

### Original Workflow (Workflow 11)

Located in `.Trash/LANGFLOW-WORKFLOWS/workflow-11-cortex-daily-brief.json`

**Original Features** (from January 13, 2026):
- üëã Greeting with timestamp
- üå§Ô∏è Duluth, MN weather
- ‚ò∏Ô∏è K3s cluster health
- üñ•Ô∏è Proxmox infrastructure status
- üåê UniFi network status
- üîí Sandfly security monitoring
- üìö **"Something interesting you've learned today"**
- üéØ Plans for the day

**Original Implementation**:
The prompt asked Claude to include "Something interesting you've learned today" but didn't actually query any data source. It was generated by Claude based on context.

---

## What Was Done

### 1. Created Updated Workflow 11 ‚úÖ

**File**: `apps/cortex-system/langflow-workflows/11-cortex-daily-brief.json`
**Commit**: `763e957`

**Added YouTube Learnings Node**:
```json
{
  "id": "youtubeLearnings",
  "type": "APIRequest",
  "position": {"x": 400, "y": 550},
  "data": {
    "node": {
      "template": {
        "url": {"value": "http://youtube-channel-intelligence.cortex.svc.cluster.local:8081/videos/recent-summaries?limit=5"},
        "method": {"value": "GET"}
      }
    }
  }
}
```

**Updated Claude Prompt**:
```
7. üìö What I learned today from YouTube: {youtubeLearnings.output}
   - Summarize the most interesting insights from recent video summaries
   - Mention specific technologies, concepts, or best practices
   - Keep it concise but informative
```

**Workflow Structure**:
1. Weather API ‚Üí Duluth weather
2. Kubernetes MCP ‚Üí Cluster health
3. Proxmox MCP ‚Üí Infrastructure status
4. Sandfly MCP ‚Üí Security posture
5. UniFi MCP ‚Üí Network status
6. **YouTube API ‚Üí Recent video summaries** ‚≠ê NEW
7. Merge all data ‚Üí Claude ‚Üí Format response

---

## What Still Needs to Be Done

### ‚ö†Ô∏è Missing API Endpoint

The workflow queries:
```
GET /videos/recent-summaries?limit=5
```

**This endpoint does NOT exist** on the YouTube Channel Intelligence service.

### Current YouTube API Endpoints

From `/app/src/index.js`:
```
GET /health
GET /metrics
POST /channels
GET /channels
GET /channels/:id
DELETE /channels/:id
POST /channels/:id/sync
GET /channels/:id/videos?offset=0&limit=50&status=completed
GET /queue/stats
GET /queue/pending
POST /queue/:videoId/priority
POST /queue/:videoId/reprocess
```

### What's Available Now

**Closest Match**: `GET /channels/:id/videos?status=completed&limit=5`

This returns recently completed videos, but doesn't include summaries.

---

## Solution Options

### Option 1: Use Existing Endpoint (Workaround)

Update workflow 11 to use:
```
GET /channels/UCKWaEZ-_VweaEx1j62do_vQ/videos?status=completed&limit=5
```

Then let Claude generate insights from video titles/metadata.

**Pros**: Works immediately
**Cons**: No actual summaries, just titles

### Option 2: Add New Endpoint (Recommended)

Add a `/videos/recent-summaries` endpoint to the YouTube service that:

1. Queries recent completed videos
2. Fetches their summaries from the ingestion database
3. Returns formatted data for Claude to analyze

**Endpoint Specification**:
```javascript
// GET /videos/recent-summaries?limit=5
{
  "count": 5,
  "videos": [
    {
      "videoId": "abc123",
      "title": "Kubernetes Best Practices 2026",
      "channelTitle": "IBM Technology",
      "publishedAt": "2026-01-14T10:00:00Z",
      "summary": "Discussion of production-ready Kubernetes patterns including...",
      "keyTopics": ["kubernetes", "devops", "containers"],
      "completedAt": "2026-01-14T15:30:00Z"
    },
    // ... 4 more videos
  ]
}
```

**Implementation**:
```javascript
// Add to /app/src/index.js

// GET /videos/recent-summaries - Get recent video summaries
if (method === 'GET' && url.startsWith('/videos/recent-summaries')) {
  try {
    const urlObj = new URL(url, 'http://localhost');
    const limit = parseInt(urlObj.searchParams.get('limit') || '10');

    // Get all channels
    const channels = await channelService.listChannels();
    const allVideos = [];

    // Fetch recent completed videos from all channels
    for (const channel of channels) {
      const videos = await channelService.getChannelVideos(
        channel.id,
        0,
        limit,
        'completed'
      );
      allVideos.push(...videos);
    }

    // Sort by completedAt (most recent first)
    allVideos.sort((a, b) =>
      new Date(b.completedAt) - new Date(a.completedAt)
    );

    // Take top N
    const recentVideos = allVideos.slice(0, limit);

    // Fetch summaries from ingestion service
    const videosWithSummaries = [];
    for (const video of recentVideos) {
      // Query ingestion database for summary
      const summary = await getSummaryFromIngestion(video.videoId);
      videosWithSummaries.push({
        ...video,
        summary: summary || 'Summary not available'
      });
    }

    return sendJSON(res, 200, {
      count: videosWithSummaries.length,
      videos: videosWithSummaries
    });
  } catch (error) {
    return sendJSON(res, 500, { error: error.message });
  }
}
```

### Option 3: Query Ingestion Service Directly

Have the Langflow workflow query the YouTube ingestion service database directly for summaries.

**Pros**: Direct access to source data
**Cons**: Coupling workflow to database schema

---

## Current YouTube Service Status

### Channel Configured ‚úÖ
```bash
$ curl http://youtube-channel-intelligence.cortex.svc.cluster.local:8081/channels
{
  "count": 1,
  "channels": [
    {
      "id": "UCKWaEZ-_VweaEx1j62do_vQ",
      "title": "IBM Technology",
      "subscriberCount": "1530000",
      "videoCount": "1520"
    }
  ]
}
```

### Video Queue Status
- **1,522 videos** discovered from IBM Technology channel
- **13 completed**, **1,521 pending**, **1,508 failed**
- Processing rate: ~10 videos/hour (rate limited)

### Transcript Extraction Issues ‚ö†Ô∏è
```
[QueueProcessor] Ingestion service error: 500 - Failed to extract transcript
```

Many videos failing transcript extraction, which prevents summary generation.

---

## Recommendation

**Immediate**: Deploy Option 1 (use existing endpoint with titles only) so the workflow functions.

**Short-term**: Fix transcript extraction issues in the YouTube ingestion service.

**Medium-term**: Implement Option 2 (add `/videos/recent-summaries` endpoint) once summaries are being generated successfully.

---

## Implementation Steps

### Step 1: Test Current Workflow

```bash
# Access Langflow
open https://langflow.ry-ops.dev

# Import workflow 11
# File: /app/flows/11-cortex-daily-brief.json
# Click Import ‚Üí Select file

# Run workflow
# Input: "hello"
# Expected: Full daily brief (will fail on YouTube endpoint)
```

### Step 2: Temporary Fix

Update workflow 11 to use:
```
http://youtube-channel-intelligence.cortex.svc.cluster.local:8081/channels/UCKWaEZ-_VweaEx1j62do_vQ/videos?status=completed&limit=5
```

### Step 3: Add New Endpoint

Create PR to add `/videos/recent-summaries` endpoint to YouTube service.

### Step 4: Fix Transcript Extraction

Debug why transcript extraction is failing (500 errors from ingestion service).

---

## Files Modified

| File | Status | Description |
|------|--------|-------------|
| `apps/cortex-system/langflow-workflows/11-cortex-daily-brief.json` | ‚úÖ Created | Workflow with YouTube learnings |
| `apps/cortex-system/langflow-workflows-configmap.yaml` | ‚úÖ Updated | Regenerated with workflow 11 |
| YouTube service `/app/src/index.js` | ‚ö†Ô∏è Needs update | Add `/videos/recent-summaries` endpoint |

**Commit**: `763e957` - "Add Cortex Daily Brief workflow (11) with YouTube learnings"

---

## Summary

‚úÖ **Restored workflow structure** with all original features
‚úÖ **Added YouTube API integration** to query learnings
‚úÖ **Committed to GitOps** for ArgoCD deployment
‚ö†Ô∏è **Missing API endpoint** - workflow will fail on YouTube query
‚ö†Ô∏è **Transcript extraction broken** - no new summaries being generated

**Next Action**: Either implement workaround (Option 1) or add proper endpoint (Option 2).

---

*Generated: January 15, 2026*
